{"version":3,"sources":["../src/baidumap_ctrl.js"],"names":["MetricsPanelCtrl","TimeSeries","kbn","_","mapRenderer","DataFormatter","MP","$","panelDefaults","ak","maxDataPoints","theme","lat","lng","initialZoom","valueName","locationData","icon","esMetric","decimals","navigation","scale","hideEmpty","overviewMap","hideZero","mapType","BaidumapCtrl","$scope","$injector","contextSrv","setMapProvider","defaults","panel","dataFormatter","markers","events","on","onInitEditMode","bind","onDataReceived","onPanelTeardown","onDataSnapshotLoad","tileServer","setMapSaturationClass","saturationClass","reload","map","snapshotLocationData","locations","jsonUrl","res","refresh","addEditorTab","dataList","dashboard","snapshot","data","setGeohashValues","tableData","tableHandler","setTableValues","tableHandlers","datas","splice","length","addNode","BMap","render","clearOverlays","point","myIcon","Icon","Size","marker","Marker","push","markerClusterer","BMapLib","MarkerClusterer","enableDragging","scontent","devEUI","type","infoWindow","InfoWindow","addEventListener","openInfoWindow","addOverlay","e","Point","alert","that","list","console","log","rawLength","translatedElements","i","translateOne","index","gps","translateCallback","returnedData","status","points","rssi","markerArray","sort","a","b","lineArray","heatPoint","count","heatArray","fport","setGradient","gradient","colors","document","querySelectorAll","slice","call","forEach","ele","getAttribute","value","heatmapOverlay","setOptions","isSupportCanvas","elem","createElement","getContext","ZoomControl","defaultAnchor","BMAP_ANCHOR_BOTTOM_RIGHT","defaultOffset","HeatmapOverlay","radius","setDataSet","max","prototype","Control","initialize","div","content","innerHTML","getContainer","appendChild","myZoomCtrl","addControl","polyline","Polyline","enableEditing","enableClicking","strokeWeight","strokeOpacity","strokeColor","addMarker","convertor","translate","Array","Convertor","setTimeout","filter","o","isNil","snapshotData","seriesData","series","datapoints","alias","target","flotpairs","getFlotPairs","nullPointMode","setZoom","parseInt","setMapStyle","style","x","body","s","getElementsByTagName","len","removeChild","navigationSwitch","removeControl","scaleSwitch","overviewMapSwitch","mapTypeSwitch","stickyLabels","scope","attrs","ctrl","templateUrl"],"mappings":"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","file":"baidumap_ctrl.js","sourcesContent":["/* eslint import/no-extraneous-dependencies: 0 */\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport TimeSeries from 'app/core/time_series2';\nimport kbn from 'app/core/utils/kbn';\n\nimport _ from 'lodash';\nimport mapRenderer from './map_renderer';\nimport DataFormatter from './data_formatter';\nimport { MP } from \"./libs/baidumap.js\";  \nimport $ from 'jquery'\n\nconst panelDefaults = {\n  ak: \"QKCqsdHBbGxBnNbvUwWdUEBjonk7jUj6\",\n  maxDataPoints: 1,\n  theme: \"normal\",\n  lat: 39.915,\n  lng: 116.404,\n  initialZoom: 11,\n  valueName: \"current\",\n  locationData: \"table\",\n  icon: \"Label\",\n  esMetric: \"Count\",\n  decimals: 0,\n  navigation: true,\n  scale: true,\n  hideEmpty: false,\n  overviewMap: false,\n  hideZero: false,\n  mapType: true\n};\nexport default class BaidumapCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector, contextSrv) {\n    super($scope, $injector);\n    this.setMapProvider(contextSrv);\n    _.defaults(this.panel, panelDefaults);\n\n    this.dataFormatter = new DataFormatter(this, kbn);\n    this.markers = [];\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n    this.events.on('data-snapshot-load', this.onDataSnapshotLoad.bind(this));\n    //this.loadLocationDataFromFile();\n  }\n\n  setMapProvider(contextSrv) {\n//    this.tileServer = contextSrv.user.lightTheme ? 'CartoDB Positron' : 'CartoDB Dark';\n    this.tileServer = 'CartoDB Positron';\n    this.setMapSaturationClass();\n  }\n\n  setMapSaturationClass() {\n    if (this.tileServer === 'CartoDB Dark') {\n      this.saturationClass = 'map-darken';\n    } else {\n      this.saturationClass = '';\n    }\n  }\n\n  loadLocationDataFromFile(reload) {\n    if (this.map && !reload) return;\n\n    if (this.panel.snapshotLocationData) {\n      this.locations = this.panel.snapshotLocationData;\n      return;\n    }\n\n    if (this.panel.locationData === \"jsonp endpoint\") {\n\n    } else if (this.panel.locationData === \"json endpoint\") {\n      if (!this.panel.jsonUrl) return;\n\n    } else if (this.panel.locationData === \"table\") {\n      // .. Do nothing\n\n    } else if (this.panel.locationData !== \"geohash\" && this.panel.locationData !== \"json result\") {\n\n    }\n  }\n\n  reloadLocations(res) {\n    this.locations = res;\n    this.refresh();\n  }\n\n  onPanelTeardown() {\n    if (this.map) delete this.map;\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Baidumap', 'public/plugins/grafana-baidumap-panel/partials/editor.html', 2);\n  }\n\n  onDataReceived(dataList) {\n    if (!dataList) return;\n    if (this.dashboard.snapshot && this.locations) {\n      this.panel.snapshotLocationData = this.locations;\n    }\n    \n    const data = [];\n    if (this.panel.locationData === \"geohash\") {\n      this.dataFormatter.setGeohashValues(dataList, data);\n    } else if (this.panel.locationData === \"table\") {\n      const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n      this.dataFormatter.setTableValues(tableData, data);\n    } else if (this.panel.locationData === \"json result\") {\n      const tableData = dataList.map(DataFormatter.tableHandlers.bind(this));\n      this.dataFormatter.setTableValues(tableData, data);\n    } else {\n      const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n      this.dataFormatter.setTableValues(tableData, data);\n    }\n    //const datas = this.filterEmptyAndZeroValues(data);\n    \n    const datas = data;\n    if(typeof this.data === 'object')this.data.splice(0, this.data.length);\n    this.markers.splice(0, this.markers.length);\n    if (datas.length) {\n      this.data = datas;\n      \n      this.map ? this.addNode(this.BMap) : this.render();\n    } else {\n      if(this.map)this.map.clearOverlays();\n      this.render();\n    }\n  }\n  \n  addMarker(point, BMap, data) {\n    const myIcon = new BMap.Icon(\"public/plugins/grafana-baidumap-panel/images/pins6-poi.png\", new BMap.Size(30, 30));\n    const marker = new BMap.Marker(point, { icon: myIcon });\n    \n    this.markers.push(marker);\n    if(this.markers.length == this.data.length){\n      const markerClusterer = new BMapLib.MarkerClusterer(this.map, {\n        markers: this.markers\n      });\n    }\n    //this.map.setViewport(pointArray);\n    marker.enableDragging();\n    let scontent = \"\";\n    scontent += '<a href=\"\"><div class=\"infobox\" id=\"infobox\"><div class=\"infobox-content\" style=\"display:block\">';\n    scontent += '<div class=\"infobox-header\"><div class=\"infobox-header-icon\"><img src=\"public/plugins/grafana-baidumap-panel/images/pins6.png\"></div>';\n    scontent += '<div class=\"infobox-header-name\"><p>'+data.devEUI+'</p></div>';\n    scontent += '<div class=\"infobox-header-type\" style=\"min-width:250px\"><p>'+data.type+'</p></div></div>';\n    scontent += '<div class=\"infobox-footer\">在线时间：10分钟前</div>';\n    scontent += '<div class=\"infobox-footer-right\"></div></div><div class=\"arrow\"></div></div></a>';\n\n    const infoWindow = new BMap.InfoWindow(scontent); // 创建信息窗口对象\n    marker.addEventListener(\"click\", function() {\n      this.map.openInfoWindow(infoWindow, point); //开启信息窗口\n    });\n\n    this.map.addOverlay(marker);\n    marker.addEventListener(\"dragend\", function(e) {\n      point = new BMap.Point(e.point.lng, e.point.lat);\n      alert(\"当前位置：\" + e.point.lng + \", \" + e.point.lat);\n    });\n  }\n\n  addNode(BMap) {    \n    var that = this;\n    const list = this.data;\n    this.map.clearOverlays();\n    console.log(list);\n    if(list){\n      const fport = this.data[0].fport;\n      const lineArray = [];\n      const heatArray = [];\n      const markerArray = [];\n      const convertor = new BMap.Convertor();\n\n      var rawLength = 0;\n      var translatedElements = [];\n\n      for (var i = 0; i < list.length; i++) {\n        setTimeout(function (index) {\n          return function () {\n            if (list[index].lng > 0 && list[index].lat > 0) {\n              rawLength++;\n              translateOne(index, list[index], BMap);\n            }\n          }\n        }(i), i * 10);\n      }\n\n      function translateOne(index, gps, BMap) {\n        function translateCallback(returnedData) {\n          if (returnedData.status == 0) {\n            translatedElements.push({\n              index: index,\n              point: returnedData.points[0],\n              rssi: gps.rssi\n            });\n            markerArray.push({point: returnedData.points[0], data: gps});\n\n            if (translatedElements.length == rawLength) {\n              translatedElements.sort(function (a, b) {\n                return a.index - b.index;\n              });\n              for (var i = 0; i < translatedElements.length; i++) {\n                lineArray.push(translatedElements[i].point);\n                var heatPoint = { lng: translatedElements[i].point.lng, lat: translatedElements[i].point.lat, count: translatedElements[i].rssi };\n                heatArray.push(heatPoint);\n              }\n\n              if (fport == \"5\") {\n                //热力图\n                if (!isSupportCanvas()) {\n                  alert(\"热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~\");\n                }\n                var heatmapOverlay = new BMapLib.HeatmapOverlay({ radius: 20 });\n                that.map.addOverlay(heatmapOverlay);\n                heatmapOverlay.setDataSet({ data: heatArray, max: 100 });\n\n                function setGradient() {\n                  var gradient = {};\n                  var colors = document.querySelectorAll(\"input[type='color']\");\n                  colors = [].slice.call(colors, 0);\n                  colors.forEach(function (ele) {\n                    gradient[ele.getAttribute(\"data-key\")] = ele.value;\n                  });\n                  heatmapOverlay.setOptions({ gradient: gradient });\n                }\n                //判断浏览区是否支持canvas\n                function isSupportCanvas() {\n                  var elem = document.createElement(\"canvas\");\n                  return !!(elem.getContext && elem.getContext(\"2d\"));\n                }\n\n                function ZoomControl() {\n                  // 默认停靠位置和偏移量\n                  this.defaultAnchor = BMAP_ANCHOR_BOTTOM_RIGHT;\n                  this.defaultOffset = new BMap.Size(10, 10);\n                }\n\n                ZoomControl.prototype = new BMap.Control();\n                ZoomControl.prototype.initialize = function (map) {\n                  var div = document.createElement(\"div\");\n                  var content = '<div id=\"heatmap_mark\"><div><span class=\"heatmap_mark_title\">颜色对应RSSI信号强度</span> <span class=\"heatmap_mark_text\" style=\"float:right;padding-top:5px\" id=\"heatmap_mark_density\">dBm</span></div><div class=\"linear_color\"></div><span class=\"heatmap_blue heatmap_mark_text heatmap_color_span\">-60以下</span><span class=\"heatmap_green heatmap_mark_text heatmap_color_span\">-60至-80</span><span class=\"heatmap_yellow heatmap_mark_text heatmap_color_span\">-80至-100</span><span class=\"heatmap_red heatmap_mark_text heatmap_color_span\">-100至-120</span><span class=\"heatmap_result_red heatmap_mark_text heatmap_color_span\">-120以上</span></div>';\n                  div.innerHTML = content;\n\n                  that.map.getContainer().appendChild(div);\n                  return div;\n                }\n\n                var myZoomCtrl = new ZoomControl();\n                that.map.addControl(myZoomCtrl);\n\n              } else if (fport == \"33\") {\n                var polyline = new BMap.Polyline(lineArray, {\n                  enableEditing: false, \n                  enableClicking: true, \n                  strokeWeight: \"4\", \n                  strokeOpacity: 0.5, \n                  strokeColor: \"blue\"\n                });\n                that.map.addOverlay(polyline);\n              } else {\n                for(const i in markerArray){\n                  that.addMarker(markerArray[i].point, BMap, markerArray[i].data);\n                }\n              }\n            }\n          } else {\n            console.log(\"转换出错: \" + returnedData.status);\n          }\n        }\n        // 转换坐标\n        var point = new BMap.Point(gps.lng, gps.lat);\n        convertor.translate(new Array(point), 1, 5, translateCallback);\n      }\n\n    }\n  }\n\n  filterEmptyAndZeroValues(data) {\n\t\treturn _.filter(data, (o) => {\n\t\t\treturn !(this.panel.hideEmpty && _.isNil(o.value)) && !(this.panel.hideZero && o.value === 0);\n\t\t});\n\t}\n\n  onDataSnapshotLoad(snapshotData) {\n    this.onDataReceived(snapshotData);\n  }\n\n  seriesHandler(seriesData) {\n    const series = new TimeSeries({\n      datapoints: seriesData.datapoints,\n      alias: seriesData.target,\n    });\n    \n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n    return series;\n  }\n  \n  setNewMapCenter() {\n    this.render();\n  }\n\n  setZoom() {\n    this.map.setZoom(parseInt(this.panel.initialZoom, 10) || 1);\n  }\n\n  setStyle() {\n\t\tthis.map.setMapStyle({ style: this.panel.theme });\n\t}\n\n  setAK() {\n    let x = document.body;\n    let s = document.getElementsByTagName(\"script\");\n    let len = s.length;\n    x.removeChild(s[len - 1]);\n    delete this.map;\n    this.render();\n\t}\n\n  navigationControl() {\n    if (this.panel.navigation == true) {\n      this.map.addControl(this.navigationSwitch);\n    } else {\n      this.map.removeControl(this.navigationSwitch);\n    }\n  }\n\n  scaleControl() {\n    if (this.panel.scale == true) {\n      this.map.addControl(this.scaleSwitch);\n    } else {\n      this.map.removeControl(this.scaleSwitch);\n    }\n  }\n\n  overviewMapControl() {\n    if (this.panel.overviewMap == true) {\n      this.map.addControl(this.overviewMapSwitch);\n    } else {\n      this.map.removeControl(this.overviewMapSwitch);\n    }\n  }\n\n  mapTypeControl() {\n    if (this.panel.mapType == true) {\n      this.map.addControl(this.mapTypeSwitch);\n    } else {\n      this.map.removeControl(this.mapTypeSwitch);\n    }\n  }\n\n  resize() {\n    \n  }\n\n  toggleStickyLabels() {\n    console.log(this.panel.stickyLabels);\n  }\n\n  changeLocationData() {\n    if (this.panel.locationData === 'geohash') {\n      this.render();\n    }\n  }\n\n/* eslint class-methods-use-this: 0 */\n  link(scope, elem, attrs, ctrl) {\n    mapRenderer(scope, elem, attrs, ctrl);\n  }\n}\n\nBaidumapCtrl.templateUrl = 'module.html';\n"]}